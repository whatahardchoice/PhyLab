# Phylab 控制台使用说明

`v0.1`

## 关于控制台

控制台是Phylab项目之前未完成的功能，目前我们对其进行了些许打磨后推出了控制台v0.1版本，可以初步支持向网站更新实验内容。控制台和本文档的内容可能随着开发而出现变化。

目前使用控制台完整新建一个实验需要你了解以下知识

* Python 3
* Jinja2 模板的简单实用
* Latex
* 简单的html编写

如果不了解也没关系，网站上的所有脚本文件都可以作为你的参考 :)

## 整体界面

进入控制台后，左侧为实验选择及数据录入区域，右侧为脚本编辑区域。脚本编辑区上部左侧按钮包括新增实验和上传实验预习报告，右侧包括删除未发布实验。脚本编辑器可以通过下方的Tab选择不同的编辑内容。编辑旗下部的三个按钮包括保存实验、运行测试和发布实验。

## 新建实验

点击“新增实验”按钮，填入实验编号、实验名称和实验大类编号后点击确认新增实验。

之后点击左侧选择实验便可以看到刚刚添加的实验

## 编写脚本

选择刚刚添加的实验，可以看到右侧编辑器窗口中内容更新（若无变化则需要用鼠标点一下编辑器界面，这是目前已知可能出现的小bug）

右侧编辑器分为三个窗口，分别是Python、Latex和Html表格。其中Python为实验数据计算的主要部分，Latex为计算结果的展示部分，Html为输入表格的设计。

每次新增实验后会生成默认的脚本模板，内容为简单的加法。

### Python

目前实验平台采用Python3.5版本，默认生成的脚本文件中已经预定义好了必须的接口和一些可选的函数。具体请参阅脚本文件。

### Latex

在控制台编写的Latex内容主要是用户点击“生成报告”后得到的报告内容，通常是实验的数据处理部分。
这里你需要通过python脚本中的jinja2模板引擎将脚本中的变量与latex模板中的变量进行绑定，因此在编写latex时需要预留出变量的位置，包括原始数据、结果和需要的中间变量。


### Html

html主要负责显示用户输入界面，并在用户点击生成报告时将数据收集起来打包成xml发送至后端。因此在编写html部分时，不仅要写好界面，也要修改最后`<script>`标签中的xml部分。

xml部分通过getElementById方法，结合表格中`<input>`标签的id获取输入值。最后后端会将这部分内容转为字符串传入脚本中。


## 运行测试

在编写好实验脚本、latex模板及表格界面后，点击保存实验可以将内容保存到服务端。**在输入框中输入数据后**点击运行测试，可以调用生成报告的接口测试整体流程。测试无论正确与否都会将服务端的运行输出返回，便于调试。

在测试出错时，通过log可以看出一些出错点

* 若log中只有python运行异常，则问题可能出在python脚本当中。特别地，当python的异常中显示read_xml函数出错时，则问题也可能出现在html表格传出的xml文本部分
* 若log中已经进入pdf生成阶段（见有pdflatex字样），则python运行应正常结束。问题可能包括latex中出现了未定义的标识符，或数据处理生成的字符串为公式，却没有出现在公式声明中。

除此之外，管理员也可以在实验编写完成后在“实验”界面实地测试脚本运行结果。

## 实验发布或删除

在测试无误后，你可以选择点击“发布实验”，将实验开放给普通用户运行。目前网站设定是一旦发布实验后，更改和删除实验都需要更高的权限。
