# 项目本地部署踩坑

## windows：xampp

下载地址：<https://sourceforge.net/projects/xampp/files/>

安装php版本为 **7.0** 的最新版

按提示安装即可

#### 配置php和mysql

清空xampp安装目录下htdocs文件夹中原有的文件。

从github上将项目clone至htdocs文件夹下，并切换到dev分支。

设置php和mysql的环境变量

在环境变量的Path变量中添加xampp\php和xampp\mysql\bin目录，重启

在powershell中运行php --version有显示即为正确。

#### 安装Laravel

进入htdocs\Phylab

运行`php composer.phar config repo.packagist composer https://packagist.laravel-china.org`，设置composer国内源。

（你也可以在windows上安装额外的composer，本次我们暂时使用项目目录内的composer程序）

删除`composer.lock`文件（如果存在的话），运行`php composer.phar install --no-scripts -vvv`，安装laravel及其依赖

运行结束后可以再运行`php composer.phar install`验证一次。

为什么不能直接运行上面的指令？因为直接运行会运行`php artisan clear-compiled`，此时laravel还没安装，从而会报错。

#### 配置数据库

和部署文档类似，首先使用powershell打开mysql

`mysql -uroot -p`回车

然后按部署文档创建数据库及管理账号

```
GRANT ALL PRIVILEGES ON *.* TO 'manager'@'localhost' IDENTIFIED BY 'password' WITH GRANT OPTION;
FLUSH PRIVILEGES;
create database Phylab_db;
use Phylab_db;
source backup.sql;
```

其中，manager为数据库账号，password为数据库密码，可以自行设置。backup.sql是数据库备份文件。

在Phylab文件夹下运行`cp .env.example .env`复制一份环境变量配置。修改其中的数据库用户名和密码。在wecenter/system/config中修改database.php，配置数据库用户名和密码。

#### 启动

首先在xampp中配置好apache的端口号，教程使用8080作为范例。你也可以通过`php artisan serve`在8000端口打开一个由laravel管理的服务器。

然后在xampp管理界面启动apache和mysql。

此时打开`localhost:8080`或运行`php artisan serve`后打开`localhost:8000`。理论上能够看到主页，如果看不到请再三检查数据库配置及apache运行情况。

登陆时需要注意勾选自动登陆。否则可能出现登陆不了的情况。（原因未知）

#### misc

本地部署的项目主要可以用于开发前端，因此以上并没有考虑安装各种生成报告的依赖，部分功能无法运行。后端建议通过符合要求的linux服务器进行。

## linux

可以按部署文档直接部署一个完整的运行环境。建议使用ubuntu 16.04，可以考虑使用虚拟机。